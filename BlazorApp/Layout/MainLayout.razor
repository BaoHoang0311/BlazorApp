@inherits LayoutComponentBase
@using Microsoft.AspNetCore.Authorization
@using System.Security.Claims
@inject BlazorSchoolAuthenticationStateProvider BlazorSchoolAuthenticationStateProvider
@attribute [AllowAnonymous]
@inject NavigationManager Navigation

@code {
    public string returnURL { get; set; }
    protected override void OnInitialized()
    {
        var currentUrl = Navigation.ToBaseRelativePath(Navigation.Uri);
        if (!string.IsNullOrEmpty(currentUrl))
        {
            returnURL = Uri.EscapeDataString("/" + currentUrl);
        }
        else
        {
            returnURL = "/";
        }
    }
}
<div class="page">
    <div class="sidebar">
        <NavMenu />
    </div>
    <main>
        <div class="top-row px-4">
            <AuthorizeView>
                <Authorized>
                    Logged in as @context.User.FindFirst(ClaimTypes.Name)?.Value
                    <br />
                    <div>Role: @string.Join(", ", @context.User.Claims.Where(x => x.Type == ClaimTypes.Role).Select(c => c.Value).ToList())</div>
                    <br>
                    <button @onclick="BlazorSchoolAuthenticationStateProvider.Logout">Logout</button>
                </Authorized>
                <NotAuthorized>
                    <button @onclick='_ => BlazorSchoolAuthenticationStateProvider.LoginAsync("admin", returnURL)'>Login as Admin</button>
                    <button @onclick='_ => BlazorSchoolAuthenticationStateProvider.LoginAsync("normal", returnURL)'>Login as Normal User</button>
                    <button @onclick='_ => BlazorSchoolAuthenticationStateProvider.LoginAsync("paid", returnURL)'>Login as Paid User</button>
                </NotAuthorized>
            </AuthorizeView>
        </div>

        <article class="content px-4">
            @Body
        </article>
    </main>
</div>
